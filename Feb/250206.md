# 동시성, 병렬성, 스케줄링 (D+4)

## 1. 동시성

<aside>
💡

`하나의 CPU` 에서 여러 작업(Process/Thread)이 `동시에 실행되는 것처럼 보이게` 하는 개념

- 병렬성과 다르다. 실제 `물리적`으로 동시에 실행되는 게 아니다.
- 병렬성과 대비되는 관계라기보단 `상호보완적인` 관계라고 볼 수 있다.
- 운영체제의 `스케줄러`가 작업 실행 순서를 조율하고 관리한다.
- 작업 간의 `전환 속도가 빠르기`때문에 병렬적(동시적으로)으로 진행되어 보이는 것.
- `하나의 CPU`에서 `여러 작업`이 메모리를 `공유`하며 `빠른 전환`을 통해 동작된다.
- 동시성이 없다면 다음 작업이 실행되기 위해선 현재 작업이 끝나야 한다. (작업 전환이 필요한 작업 영역에 유효하게 적용)

### 투박한 이해

`비동시성`: A(10ms) → B(10ms) → C(10ms)

`동시성(빠른전환)`:  A(0.0001ms) → B(0.0001ms) → C(0.0001ms) → A(0.0001ms) → B(0.0001ms) → C(0.0001ms) → A(0.0001ms) → B(0.0001ms) → C(0.0001ms) → … → … → …

![image](https://github.com/user-attachments/assets/f0e8127e-f6be-4705-829d-aa4d2b9440b3)


### 그냥 병렬적으로 실행하면 되는데 동시성이 왜 필요할까?

- 라면을 끓이는 것을 굳이 여러명이서 처리할 필요가 없기 때문.
- 리소스(시스템 자원)를 아끼고 최적의 효율성으로 실행하기 위함.

### 실생활 예시 (동시성↔병렬성)

- 카페에서 알바 한 명이 여러 주문을 처리함(동시성) ↔ 알바 여러명이 주문을 처리함(병렬성)
</aside>

## 2. 병렬성

<aside>
💡

`여러 CPU 코어` 또는 `멀티 프로세서`를 사용하여 `물리적`으로 `동시에 실행`하는 개념

- 물리적으로 동시에 처리되기 때문에 하드웨어 지원이 필수적(의존적)
- 하드웨어(물리적) 자원이 많을 수록 더 많은 병렬 처리가 가능해짐
- 작업끼리 독립적으로 진행됨
    
    ![image](https://github.com/user-attachments/assets/77e083db-2239-4e24-bd3d-0e863d8260f7)

    

### 활용 영역

1. 실시간 처리

실시간 시스템(게임, 스트리밍 등)에서의 작업의 병목 현상이 일어나지 않도록 병렬적으로 처리하여 사용자 경험을 높일 수 있음

1. 대규모 데이터 처리

병렬적으로 처리하다보니 작업 속도가 빨라져 대규모 작업을 더 빠르고 효율적으로 수행할 수 있음

</aside>

## 3. 스케쥴러

<aside>
💡

운영체제의 핵심 구성 요소로서 작업끼리의 스케줄을 조정하는 책임을 가진다.

### 주요 기능(책임)

1. `작업 선택`: 순간순간 다음 작업을 선택 결정 (우선 순위에 따라)
2. `자원 분배`: 제한된 리소스를 공평하게 효율적으로 분배
3. `컨텍스트 스위칭 관리`: 작업 간 전환 시, 이전 작업의 상태를 저장하고 역으로 복원하여 중단 없이 진행되도록 함
    - 이전 작업의 상태를 레지스터, 프로그램 카운터 등에(=프로세서의 작은 메모리 공간)  저장
</aside>

### 3-1. 라운드로빈 스케쥴링

<aside>
💡

`Preemptive(선점)` 스케줄링 방식

- `라운드 로빈(Round Robin)`은 서명자의 순서를 알 수 없게 둥글게 적은 문서를 뜻한다.
    
    ![image](https://github.com/user-attachments/assets/de6bad0a-4aec-45ab-b8a6-5380e03252fe)

    
- 각 프로세스(작업)은 순서대로 동일한 크기의 CPU 시간을 할당 받고, 할당 시간 내에 완료되지 못하면 준비 큐의 가장 뒤로 보내진다.
    
    ![image](https://github.com/user-attachments/assets/ea2de550-186e-4d0c-aa05-def550c739cd)

    
    라운드 로빈(RR) 스케줄링
    

### CPU 할당 시간

1. **할당 시간이 너무 큰 경우**
- 한번의 할당에 프로세스가 완료되기 때문에 라운드 로빈 스케줄링의 의미가 퇴색되어 버림.

![image](https://github.com/user-attachments/assets/cebb7345-3cd4-4aa4-b7d5-8389119bc89a)


- FCFS 방식과 똑같이 동작해버린다.
    
    ![image](https://github.com/user-attachments/assets/ae62a324-be9e-48db-ba80-e9be48186a3c)

    
    FCFS(First Come First Served) 스케줄링
    
1. 할당 시간이 너무 짧은 경우

컨텍스트 스위칭(문맥 교환)에 많은 리소스가 소모되어 `오버 헤드`가 발생한다.

</aside>

### 3-2. (선택) 콘보이 현상

### 3-3. (선택) 선점형 /  비선점형 스케쥴링

<aside>
💡

작업(프로세스)가 선점을 당할 수 있으면 선점형이고, 선점을 당하는 것이 허락 당하지 않으면 비선점

- **비선점(non preemptive) 스케줄링**

**하나의 프로세스에 중앙처리장치가 할당되면 그 프로세스의 수행이 끝날 때까지 중앙처리장치는 그 프로세스로부터 빠져나올 수 없음**

- **선점(preemptive) 스케줄링**

**하나의 프로세스가 중앙처리장치를 차지하고 있을 때 다른 프로세스가 현재 수행 중인 프로세스를 중지시키고 중앙처리장치를 차지할 수 있음**

</aside>

## 4. 컨텍스트 스위칭

<aside>
💡

OS의 스케줄러가 관리하는 작업 중의 하나인 “작업의 전환 과정에서의 이전 상태 저장 및 복원의 과정”

</aside>

## 5. 스레드풀

<aside>
💡

- `미리` 일정 수의 스레드를 `생성`해 놓고, 필요할 때마다 해당 스레드를 `재사용`하여 작업을 처리하는 기법
</aside>

## 6. 동시성과 병렬성의 차이를 설명해주세요

<aside>
💡

### 답변

1. 동시성은 하드웨어에 비의존적이지만 병렬성은 물리적 하드웨어에 의존적이다.
2. 그렇기 때문에 병렬성은 여러개의 프로세서 또는 다중 코어가 필요하다.
3. 동시성은 실제로 동시에  처리하지 않기 때문에 작업의 전환과 우선순위에 따른 작업 실행을 위해 스케줄러의 도움이 필요하다.
</aside>

## 7. 멀티 쓰레드 환경에서의 동시성과 병렬성을 설명해주세요

<aside>
💡

### 답변

- 기본적으로 병렬성은 다중 프로세스 혹은 코어에서 병렬적으로 작업을 처리하는 방법이다.
- 코어 = 물리적 코어(하드웨어)/ 스레드 = 논리적 코어(운영체제)
- 4 Core 8Thread CPU이라면, 운영체제는 위와 같이 4개의 코어가 한번은 스레드 TH 0, TH 2, TH4, TH 6으로 동작했다가, 다음엔 스레드 TH 1, TH 3, TH5, TH 7으로 콘텍스트 스위칭하여 동작하도록 한다.
- 동시성은 멀티 스레드의 싱글 코어에 적용되는 개념이고, 병렬성은 다중 코어에 적용되는 개념이다.
- 컴퓨터 하드웨어의 여러코어/프로세서에서 작업을 동시에 처리하는 것은 병렬성이다. 각각의 코어 환경을 소프트웨어적으로 구성한 가상 공간에서 병렬적으로 처리하는 것은 동시성이다.
</aside>

## 8. 컨텍스트 스위칭이 발생할 때 생기는 부정적인 영향에 대해서 설명해주세요

<aside>
💡

### 답변

: 문맥 교환을 하면서 스케줄러가 이전 작업의 상태를 프로세서의 작은 메모리 공간에 저장하게 되는데, 이렇듯 별도로 유지 관리해야 되는 부담(오버헤드)이 생기게 되어 시스템 관점에서 부정적인 영향으로 볼 수 있다.

</aside>

## 9. 스레드풀을 사용하는 이유와 장단점에 대해서 설명해주세요

<aside>
💡

- 스레드를 지우고 생성하는데 부담스러운 `리소스(비용)`이 든다.
- 그래서 `미리` 스레드를 여러개 `생성`해놓고 `재활용`하는 방법
- 스레드를 생성하고 소멸하는 과정이 없기 때문에 -> `오버헤드`를 줄이게 된다.
</aside>

## (선택)프로세스 스케쥴링과 스레드 스케쥴링의 차이점에 대해서 설명해주세요

<aside>
💡

프로세스 컨텍스트 스위칭과 스레드 컨텍스트 스위칭중 어떤 것이 더 오래 걸리는 작업일까요?

프로세스 컨텍스트 스위칭이 더 오래걸립니다.

프로세스의 컨텍스트 스위칭 과정은 크게 지금까지 작업한 내용을 저장 + Flush을 통한 메모리 초기화 작업으로 정리됩니다.

이때, Flush를 하는 이유는 새로 실행되는 프로세스가 기존에 실행되는 프로세스의 메모리 주소 공간에 침범하면 안 되기 때문입니다.

반면, 스레드는 메모리 주소 공간을 공유하기 때문에 Flush 하는 작업을 수행하지 않아도 됩니다.

따라서, 지금까지 작업한 내용을 저장하는 작업만 수행합니다.

</aside>
